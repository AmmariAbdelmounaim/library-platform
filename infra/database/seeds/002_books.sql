-- ===============================================
-- 002_books.sql
-- Seed initial books and authors data (generated from Google Books API)
-- Generated: 2025-11-21T09:53:51.507Z
-- ===============================================

-- Insert authors first (books reference authors through book_authors junction table)
INSERT INTO authors(first_name, last_name, birth_date, death_date)
VALUES
    ('George', 'Orwell', '1903-06-25'::DATE, '1950-01-21'::DATE),
    ('Jane', 'Austen', '1775-12-16'::DATE, '1817-07-18'::DATE),
    ('F. Scott', 'Fitzgerald', '1896-09-24'::DATE, '1940-12-21'::DATE),
    ('Harper', 'Lee', '1926-04-28'::DATE, '2016-02-19'::DATE),
    ('J.D.', 'Salinger', '1919-01-01'::DATE, '2010-01-27'::DATE),
    ('J.R.R.', 'Tolkien', '1892-01-03'::DATE, '1973-09-02'::DATE),
    ('J.K.', 'Rowling', '1965-07-31'::DATE, NULL),
    ('Ernest', 'Hemingway', '1899-07-21'::DATE, '1961-07-02'::DATE),
    ('Virginia', 'Woolf', '1882-01-25'::DATE, '1941-03-28'::DATE),
    ('Gabriel', 'García Márquez', '1927-03-06'::DATE, '2014-04-17'::DATE),
    ('Toni', 'Morrison', '1931-02-18'::DATE, '2019-08-05'::DATE),
    ('Maya', 'Angelou', '1928-04-04'::DATE, '2014-05-28'::DATE),
    ('Isaac', 'Asimov', '1920-01-02'::DATE, '1992-04-06'::DATE),
    ('Ray', 'Bradbury', '1920-08-22'::DATE, '2012-06-05'::DATE),
    ('Agatha', 'Christie', '1890-09-15'::DATE, '1976-01-12'::DATE)
ON CONFLICT DO NOTHING;

-- Insert books
-- Note: The search_vector will be automatically generated by the trigger
-- The updated_at will be automatically set by the trigger
-- Using WHERE NOT EXISTS to handle duplicates since ON CONFLICT doesn't work with partial unique indexes
INSERT INTO books(title, isbn_10, isbn_13, genre, publication_date, description, cover_image_url, external_source, external_id)
SELECT * FROM (VALUES
    ('1984', '0547249640', '9780547249643', 'Fiction', '1949-06-08'::DATE, '75th ANNIVERSARY EDITION “Orwell saw, to his credit, that the act of falsifying reality is only secondarily a way of changing perceptions. It is, above all, a way of asserting power.”—The New Yorker In 1984, London is a grim city in the totalitarian state of Oceania where Big Brother is always watching you and the Thought Police can practically read your mind. Winston Smith is a man in grave danger for the simple reason that his memory still functions. Drawn into a forbidden love affair, Winston finds the courage to join a secret revolutionary organization called The Brotherhood, dedicated to the destruction of the Party. Together with his beloved Julia, he hazards his life in a deadly match against the powers that be. Lionel Trilling said of Orwell’s masterpiece, “1984 is a profound, terrifying, and wholly fascinating book. It is a fantasy of the political future, and like any such fantasy, serves its author as a magnifying device for an examination of the present.” Though the year 19', 'http://books.google.com/books/content?id=kotPYEqx7kMC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'kotPYEqx7kMC'),
    ('Pride and Prejudice', '3989956027', '9783989956025', 'Fiction', '1813-01-28'::DATE, 'On the verdant plains of 18th-century England, in the heart of the Hertfordshire countryside, a timeless story of passion, pride and prejudice unfolds. Elizabeth Bennet, a lively, intelligent young woman, is the second of five sisters in a family of modest means. Her sharp mind and independent spirit set her apart in a society where propriety and matrimonial alliances are central concerns.When she crosses paths with Mr. Darcy, an aristocrat as wealthy as he is arrogant, Elizabeth is immediately struck by his coldness and pride. However, as her encounters and misunderstandings progress, she discovers that beyond first impressions lies a man far more complex and vulnerable than she could have imagined.Jane Austen''s masterpiece "Pride and Prejudice" is a subtle and poignant exploration of social dynamics and human relationships. Through brilliant dialogue and incisive narration, Austen paints a fascinating picture of the struggle between social classes and the barriers of love. It''s a sto', 'http://books.google.com/books/content?id=ydULEQAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'ydULEQAAQBAJ'),
    ('The Great Gatsby', '1438114540', '9781438114545', 'Electronic books', '1925-04-10'::DATE, 'This series provides comprehensive reading and study guides for some of the world''s most important literary masterpieces.', 'http://books.google.com/books/content?id=adjCx-wnhWsC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'adjCx-wnhWsC'),
    ('To Kill a Mockingbird', '0871299208', '9780871299208', 'Fiction', '1960-07-11'::DATE, 'Harper Lee''s classic novel of a lawyer in the Deep South defending a black man charged with the rape of a white girl. One of the best-loved stories of all time, To Kill a Mockingbird has earned many distinctions since its original publication in 1960. It won the Pulitzer Prize, has been translated into more than forty languages, sold more than thirty million copies worldwide, and been made into an enormously popular movie. Most recently, librarians across the country gave the book the highest of honors by voting it the best novel of the twentieth century.', 'http://books.google.com/books/content?id=0NEbHGREK7cC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', '0NEbHGREK7cC'),
    ('The Catcher in the Rye', '0241988799', '9780241988794', 'Fiction', '1951-07-16'::DATE, '''If you really want to hear about it, the first thing you''ll probably want to know is where I was born and what my lousy childhood was like, and how my parents were occupied and all before they had me, and all that David Copperfield kind of crap, but I don''t feel like going into it, if you want to know the truth.'' The first of J. D. Salinger''s four books to be published, The Catcher in the Rye is one of the most widely read and beloved of all contemporary American novels. ''The handbook of the adolescent heart'' The New Yorker', 'http://books.google.com/books/content?id=mZunDwAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'mZunDwAAQBAJ'),
    ('The Hobbit', '0007270615', '9780007270613', 'Comics & Graphic Novels', '1937-09-21'::DATE, '''The Hobbit'' is a tale of high adventure, undertaken by a company of dwarves in search of dragon-guarded gold. A reluctant partner in this perilous quest is Bilbo Baggins, a comfort-loving, unambitious hobbit.', 'http://books.google.com/books/content?id=F2xu1nZOzKoC&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', 'F2xu1nZOzKoC'),
    ('The Fellowship of the Ring', '0345339703', '9780345339706', 'Fiction', '1954-07-29'::DATE, 'The opening novel of The Lord of the Rings—the greatest fantasy epic of all time—which continues in The Two Towers and The Return of the King. Nominated as one of America’s best-loved novels by PBS’s The Great American Read The dark, fearsome Ringwraiths are searching for a Hobbit. Frodo Baggins knows that they are seeking him and the Ring he bears—the Ring of Power that will enable evil Sauron to destroy all that is good in Middle-earth. Now it is up to Frodo and his faithful servant, Sam, with a small band of companions, to carry the Ring to the one place it can be destroyed: Mount Doom, in the very center of Sauron’s realm.', 'http://books.google.com/books/content?id=7iS1CCpHrJgC&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', '7iS1CCpHrJgC'),
    ('Harry Potter and the Philosopher''s Stone', '1408810549', '9781408810545', 'Children''s stories', '1997-06-26'::DATE, '"Harry Potter thinks he is an ordinary boy. He lives with Uncle Vernon, Aunt Petunia and his cousin, Dudley, who make him sleep in a cupboard under the stairs. Then Harry starts receiving mysterious letters and his life is changed for ever. He is whisked away by a beetle-eyed giant of a man and enrolled in Hogwarts School of Witchcraft and Wizardry. The reason: Harry Potter is a wizard!"--P. [4] of cover.', 'http://books.google.com/books/content?id=djf_RQAACAAJ&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', 'djf_RQAACAAJ'),
    ('The Old Man and the Sea', '0822009358', '9780822009351', 'Literary Criticism', '1952-09-01'::DATE, 'This is the Nobel Prize-winning author2s powerful story of an old man who conquers a magnificent fish, endures its heartbreaking loss, and rises gallantly above his defeat. Though it is a small book, it is a jewel.', 'http://books.google.com/books/content?id=7FXVvA2pNoYC&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', '7FXVvA2pNoYC'),
    ('Mrs. Dalloway', '3736812361', '9783736812369', 'Fiction', '1925-05-14'::DATE, 'Virginia Woolf (1882–1941) was an English writer, and one of the foremost modernists of the twentieth century.Mrs Dalloway is a novel by Virginia Woolf that details a day in the life of Clarissa Dalloway, a fictional high-society woman in post-World War I England. It is one of Woolf''s best-known novels. Created from two short stories, "Mrs Dalloway in Bond Street" and the unfinished "The Prime Minister," the novel addresses Clarissa''s preparations for a party she will host that evening. With an interior perspective, the story travels forwards and back in time and in and out of the characters'' minds to construct an image of Clarissa''s life and of the inter-war social structure. In October 2005, Mrs Dalloway was included on TIME magazine''s list of the 100 best English-language novels written since 1923.', 'http://books.google.com/books/content?id=XSa0AwAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'XSa0AwAAQBAJ'),
    ('One Hundred Years of Solitude', '0241968593', '9780241968598', 'Fiction', '1967-05-30'::DATE, 'ONE OF THE WORLD''S MOST FAMOUS BOOKS AND WINNER OF THE NOBEL PRIZE FOR LITERATURE _______________________________ ''Many years later, as he faced the firing squad, Colonel Aureliano Buendía was to remember that distant afternoon when his father took him to discover ice'' Gabriel García Márquez''s great masterpiece is the story of seven generations of the Buendía family and of Macondo, the town they built. Though little more than a settlement surrounded by mountains, Macondo has its wars and disasters, even its wonders and its miracles. A microcosm of Columbian life, its secrets lie hidden, encoded in a book, and only Aureliano Buendía can fathom its mysteries and reveal its shrouded destiny. Blending political reality with magic realism, fantasy and comic invention, One Hundred Years of Solitude is one of the most daringly original works of the twentieth century. _______________________________ ''As steamy, dense and sensual as the jungle that surrounds the surreal town of Macondo!'' Oprah,', 'http://books.google.com/books/content?id=RyGVAgAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'RyGVAgAAQBAJ'),
    ('Beloved', '030738862X', '9780307388629', 'Fiction', '1987-09-02'::DATE, 'PULITZER PRIZE WINNER • NEW YORK TIMES BESTSELLER • This "powerful, mesmerizing story” (People) is an unflinching look into the abyss of slavery, from the acclaimed Nobel Prize winner. With an afterword by the author and a new introduction by Honorée Fannon Jeffers. “A masterwork.... Wonderful.... I can’t imagine American literature without it.” —John Leonard, Los Angeles Times Sethe was born a slave and escaped to Ohio, but eighteen years later she is still not free. Sethe has too many memories of Sweet Home, the beautiful farm where so many hideous things happened. And Sethe’s new home is haunted by the ghost of her baby, who died nameless and whose tombstone is engraved with a single word: Beloved. “Dazzling. . . . Magical. . . . An extraordinary work.” —The New York Times', 'http://books.google.com/books/content?id=sfmp6gjZGP8C&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', 'sfmp6gjZGP8C'),
    ('I Know Why the Caged Bird Sings', '1588369250', '9781588369253', 'Autobiography', '1969-01-01'::DATE, 'Here is a book as joyous and painful, as mysterious and memorable, as childhood itself. I Know Why the Caged Bird Sings captures the longing of lonely children, the brute insult of bigotry, and the wonder of words that can make the world right. Maya Angelou’s debut memoir is a modern American classic beloved worldwide. Sent by their mother to live with their devout, self-sufficient grandmother in a small Southern town, Maya and her brother, Bailey, endure the ache of abandonment and the prejudice of the local “powhitetrash.” At eight years old and back at her mother’s side in St. Louis, Maya is attacked by a man many times her age—and has to live with the consequences for a lifetime. Years later, in San Francisco, Maya learns that love for herself, the kindness of others, her own strong spirit, and the ideas of great authors (“I met and fell in love with William Shakespeare”) will allow her to be free instead of imprisoned. Poetic and powerful, I Know Why the Caged Bird Sings will touc', 'http://books.google.com/books/content?id=VdxNlZidgikC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'VdxNlZidgikC'),
    ('Foundation', '055390034X', '9780553900347', 'Fiction', '1951-05-01'::DATE, 'The first novel in Isaac Asimov’s classic science-fiction masterpiece, the Foundation series THE EPIC SAGA THAT INSPIRED THE APPLE TV+ SERIES FOUNDATION • Nominated as one of America’s best-loved novels by PBS’s The Great American Read For twelve thousand years the Galactic Empire has ruled supreme. Now it is dying. But only Hari Seldon, creator of the revolutionary science of psychohistory, can see into the future—to a dark age of ignorance, barbarism, and warfare that will last thirty thousand years. To preserve knowledge and save humankind, Seldon gathers the best minds in the Empire—both scientists and scholars—and brings them to a bleak planet at the edge of the galaxy to serve as a beacon of hope for future generations. He calls his sanctuary the Foundation. The Foundation novels of Isaac Asimov are among the most influential in the history of science fiction, celebrated for their unique blend of breathtaking action, daring ideas, and extensive worldbuilding. In Foundation, Asimo', 'http://books.google.com/books/content?id=IwywDY4P6gsC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'IwywDY4P6gsC'),
    ('Fahrenheit 451', '143914267X', '9781439142677', 'Fiction', '1953-10-19'::DATE, 'Nearly seventy years after its original publication, Ray Bradbury’s internationally acclaimed novel Fahrenheit 451 stands as a classic of world literature set in a bleak, dystopian future. Today its message has grown more relevant than ever before. Guy Montag is a fireman. His job is to destroy the most illegal of commodities, the printed book, along with the houses in which they are hidden. Montag never questions the destruction and ruin his actions produce, returning each day to his bland life and wife, Mildred, who spends all day with her television “family.” But when he meets an eccentric young neighbor, Clarisse, who introduces him to a past where people didn’t live in fear and to a present where one sees the world through the ideas in books instead of the mindless chatter of television, Montag begins to question everything he has ever known.', 'http://books.google.com/books/content?id=OYtkbGl2j0sC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api', 'google_books', 'OYtkbGl2j0sC'),
    ('Murder on the Orient Express', '0606106391', '9780606106399', 'Fiction', '1934-01-01'::DATE, 'For use in schools and libraries only. On a three-day journey through the snowbound Balkan hills, Hercule Poirot must weed through an array of international suspects to find the passenger who murdered a gangster on the Orient Express.', 'http://books.google.com/books/content?id=v6HrQwAACAAJ&printsec=frontcover&img=1&zoom=1&source=gbs_api', 'google_books', 'v6HrQwAACAAJ')
) AS v(title, isbn_10, isbn_13, genre, publication_date, description, cover_image_url, external_source, external_id)
WHERE NOT EXISTS (
    SELECT 1 FROM books b 
    WHERE (b.isbn_13 = v.isbn_13 AND b.isbn_13 IS NOT NULL)
       OR (b.isbn_10 = v.isbn_10 AND b.isbn_10 IS NOT NULL)
       OR (b.external_id = v.external_id AND b.external_source = v.external_source)
);

-- Link books to authors through book_authors junction table
-- Using subqueries to match by title and author name
INSERT INTO book_authors(book_id, author_id)
SELECT b.id, a.id
FROM books b
CROSS JOIN authors a
WHERE (
 (b.title = '1984' AND a.first_name = 'George' AND a.last_name = 'Orwell')
    OR (b.title = 'Pride and Prejudice' AND a.first_name = 'Jane' AND a.last_name = 'Austen')
    OR (b.title = 'The Great Gatsby' AND a.first_name = 'F. Scott' AND a.last_name = 'Fitzgerald')
    OR (b.title = 'To Kill a Mockingbird' AND a.first_name = 'Harper' AND a.last_name = 'Lee')
    OR (b.title = 'The Catcher in the Rye' AND a.first_name = 'J.D.' AND a.last_name = 'Salinger')
    OR (b.title = 'The Hobbit' AND a.first_name = 'J.R.R.' AND a.last_name = 'Tolkien')
    OR (b.title = 'The Fellowship of the Ring' AND a.first_name = 'J.R.R.' AND a.last_name = 'Tolkien')
    OR (b.title = 'Harry Potter and the Philosopher''s Stone' AND a.first_name = 'J.K.' AND a.last_name = 'Rowling')
    OR (b.title = 'The Old Man and the Sea' AND a.first_name = 'Ernest' AND a.last_name = 'Hemingway')
    OR (b.title = 'Mrs. Dalloway' AND a.first_name = 'Virginia' AND a.last_name = 'Woolf')
    OR (b.title = 'One Hundred Years of Solitude' AND a.first_name = 'Gabriel' AND a.last_name = 'García Márquez')
    OR (b.title = 'Beloved' AND a.first_name = 'Toni' AND a.last_name = 'Morrison')
    OR (b.title = 'I Know Why the Caged Bird Sings' AND a.first_name = 'Maya' AND a.last_name = 'Angelou')
    OR (b.title = 'Foundation' AND a.first_name = 'Isaac' AND a.last_name = 'Asimov')
    OR (b.title = 'Fahrenheit 451' AND a.first_name = 'Ray' AND a.last_name = 'Bradbury')
    OR (b.title = 'Murder on the Orient Express' AND a.first_name = 'Agatha' AND a.last_name = 'Christie')
)
ON CONFLICT (book_id, author_id) DO NOTHING;

-- Log seed completion
DO $$
BEGIN
    RAISE NOTICE '✓ Books and authors seeded successfully';
    RAISE NOTICE '  - Authors inserted: %', (SELECT COUNT(*) FROM authors);
    RAISE NOTICE '  - Books inserted: %', (SELECT COUNT(*) FROM books);
    RAISE NOTICE '  - Book-author relationships: %', (SELECT COUNT(*) FROM book_authors);
END $$;
